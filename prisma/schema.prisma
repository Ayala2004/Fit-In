generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id               String      @id @default(auto()) @map("_id") @db.ObjectId
  username         String      @unique
  password         String
  firstName        String
  lastName         String
  email            String      @unique
  roles            String[]
  isAdmin          Boolean     @default(false)
  isWorking        Boolean     @default(true)
  idNumber         String      @unique
  phoneNumber      String
  dateOfBirth      DateTime
  address          String?
  
  institutionId    String?     @db.ObjectId
  institution      Institution? @relation("InstitutionUsers", fields: [institutionId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  managedInstitutions Institution[] @relation("InstitutionManager")
  
  placementsAsMain    Placement[] @relation("MainTeacher")
  placementsAsSub     Placement[] @relation("SubstituteTeacher")
}

model Institution {
  id                String      @id @default(auto()) @map("_id") @db.ObjectId
  name              String
  address           String
  institutionNumber String      @unique

  managerId         String?     @db.ObjectId
  manager           User?       @relation("InstitutionManager", fields: [managerId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  
  users             User[]      @relation("InstitutionUsers")
  placements        Placement[]
}

model Placement {
  id                String      @id @default(auto()) @map("_id") @db.ObjectId
  date              DateTime
  status            String      // SUBSTITUTE, EXCHANGE, CLOSED
  
  institutionId     String      @db.ObjectId
  institution       Institution @relation(fields: [institutionId], references: [id])
  
  mainTeacherId     String      @db.ObjectId
  mainTeacher       User        @relation("MainTeacher", fields: [mainTeacherId], references: [id])
  
  substituteId      String?     @db.ObjectId
  substitute        User?       @relation("SubstituteTeacher", fields: [substituteId], references: [id])
  
  notes             String?
  createdAt         DateTime    @default(now())
}
